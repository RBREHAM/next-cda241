name: Test pipeline 1

run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4
        - name: Cache node modules
          id: cache-npm
          uses: actions/cache@v4
          with:
            path: |
                node_modules
                /home/runner/.cache/Cypress
            key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package-lock.json') }}
        - run: npm install
        - run: npm run build

    test:
        needs: build
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4

        - name: Restore cache
          uses: actions/cache/restore@v4
          with:
            path: |
                node_modules
                /home/runner/.cache/Cypress
            key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package-lock.json') }}
        
        - name: Cypress run
          uses: cypress-io/github-action@v6
          with:
            build: npm run build
            start: npm start
            install: false

        - name: Download Cypress videos 
          if: always()
          uses: actions/upload-artifact@v4
          with: 
            name: cypress-videos
            path: cypress/videos
            retention-days: 5

        - name: Download Cypress screenshots 
          if: failure()
          uses: actions/upload-artifact@v4
          with: 
            name: cypress-screenshots
            path: cypress/screenshots
            retention-days: 5