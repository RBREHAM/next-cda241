name: Test pipeline 1

run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4
        - name: Cache node modules
          id: cache-npm
          uses: actions/cache@v4
          with:
            # npm cache files are stored in `~/.npm` on Linux/macOS
            path: ~/.npm
            key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package-lock.json') }}
            restore-keys: |
                ${{ runner.os }}-build-cache-node-modules-
                ${{ runner.os }}-build-
                ${{ runner.os }}-
        - name: Restore cache
          uses: actions/cache@v4
          with:
            path: .next/cache # Generate a new cache whenever packages or source files change.
            key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json', '**/yarn.lock') }}-${{ hashFiles('**.[jt]s', '**.[jt]sx') }}
            # If source files changed but packages didn't, rebuild from a prior cache.
            restore-keys: |
                ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json', '**/yarn.lock') }}-
        - name: Install dependencies
          run: npm install
        - name: Build with Next.js
          run: npm run build

    tests:
        needs: build
        runs-on: ubuntu-24.04
        steps:
        - name: Checkout
          uses: actions/checkout@v4
        # Install npm dependencies, cache them correctly
        # and run all Cypress tests

        
        - name: Cypress run
          uses: cypress-io/github-action@v6
          with:
            install: false
            cache-key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package-lock.json') }}
            build: npm run build
            start: npm start