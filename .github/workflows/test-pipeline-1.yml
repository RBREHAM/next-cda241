name: Test pipeline 1

run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4
        - name: Install dependencies
          run: npm install
        - name: Build with Next.js
          run: npm run build
        - name: Cache node modules
          id: cache-npm
          uses: actions/cache@v4
          with:
            path: node_module # npm cache files are stored in `~/.npm` on Linux/macOS
            key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package-lock.json') }}

    test:
        needs: build
        runs-on: ubuntu-24.04
        steps:
        - name: Checkout
          uses: actions/checkout@v4

        - name: Restore cache
          uses: actions/cache/restore@v4
          with:
            path: node_module
            key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package-lock.json') }}
        
        - name: Cypress run
          uses: cypress-io/github-action@v6
          with:
            run: npm run e2e:headless

        # - name: Download Cypress videos 
        #   if: always()
        #   uses: actions/upload-artifacts-@v4
        #   with: 
        #     name: cypress-videos
        #     path: cypress/videos
        #     retention-days: 5

        # - name: Download Cypress screenshots 
        #   if: failure()
        #   uses: actions/upload-artifacts-@v4
        #   with: 
        #     name: cypress-screenshots
        #     path: cypress/screenshots
        #     retention-days: 5